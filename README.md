Traks - a translation system for React/JSX.

### Demo

See `traks-zoo` (https://github.com/aktiedysten/traks-zoo). Its commit history
also serves as a step-by-step guide for setting up `traks` using `create-react-app`.


### Introduction
The basic idea is to add elements in your JSX code like this:
```js
<T>You have {count} unread message(s)</T>
```

Then you run `bin/traks update` (in this example `bin/traks update --langs en,da`) which searches for `<T>` tags in your source code.
New tags are automatically added to your translations file, and looks like this:

```js
	"e8c2410dd77c": {
		"_new": true, // FIXME remove this line when translation is done
		"en": (count) => <O>You have {count} unread message(s)</O>,
		"da": (count) => <O>You have {count} unread message(s)</O>,
	},
```

You can then translate it and even handle plural/singular cases by changing it into this:
```js
	"e8c2410dd77c": {
		"en": (count) => {
			switch (count) {
			case 0: return <O>You have no unread messages</O>;
			case 1: return <O>You have 1 unread message</O>;
			default: return <O>You have {count} unread messages</O>;
			}
		},
		"da": (count) => {
			switch (count) {
			case 0: return <O>Du har ingen ulæste beskeder</O>;
			case 1: return <O>Du har 1 ulæst besked</O>;
			default: return <O>Du har {count} ulæste beskeder</O>;
			}
		},
	},
```

### More features
 - You can provide context when ambiguities arise, e.g. `<T context="file">Save</T>`
   and `<T context="money">Save</T>` - these result in separate translation keys so
   you can translate them differently.
 - Dependencies are captured automatically, for example `count` in the introduction above. But you can also
   specify additional dependencies: `<T deps={[foo]}>Translate me</T>` will add `foo` as dependency and
   pass it to your translation function even though `foo` is not used inside the `<T>` tag.
 - At Aktiedysten ApS we've combined `context` and `deps` to format dates and such, e.g.
   `<T context="1 January 2018" deps={[timestamp]}></T>` - then the language specific date formatting happens
   in the respective translation functions.
 - Translations can be "baked", so that only one language is included when the site is built. See `traks-zoo` (specifically
   https://github.com/aktiedysten/traks-zoo/blob/master/bake-npm-start.sh), for an example on how to do this. By default,
   all translations are included in the build, so baking saves space.

### Caveats
 - It's not trivial to install; `npm install traks` isn't enough; you also need to insert our custom
   Babel preset (see `react-app.js`) into the compilation flow (this is where the "magic" handling of
   `<T>` tags happens). If you're using `create-react-app` you need to eject it before modifying the Babel
   preset is even possible (this is what `traks-zoo` did). Other build setups have not been tested.
 - There are restrictions on how you can use `<T>` tags; see the autogenerated `traks.js` and
   `traks-translations.js` files for documentation on this.

### Why?

The two most popular translation solutions for React are `react-intl` and `react-i18next`.
Both have a verbose and unnatural syntax, and want you to assign keys to every translation.
I have previously worked with `gettext` which is intuitive to work with, has a light syntax and it automatically
extracts translation strings from your source code. So, I desired something similar for React.

### Traks 3 migration notes

Traks 3 introduces breaking changes in how "function signatures" are made, and
therefore what the translation hashes/keys will be. The change is roughly that
newlines are now considered whitespace, so before, "foo bar" on two lines would
hash to a different key than if on one line, but in Traks 3 they hash to the
same key. This means that old keys are incompatible with new keys.

Upgrading from 2 to 3 is possible, but requires a bit of a "dance"; doing
things in the proper order:

 - I recommend doing this in a branch, or otherwise using git in a manner that
   you can easily undo your changes.
 - You should run `update-translations.js` before upgrading.
 - Then upgrade traks from 2 to 3 using npm/yarn (NOTE: if you need to revert
   steps, be sure to also re-install `node_modules`. Yes, I've shot myself in
   the foot by having traks 2 in package.json, but traks 3 in `node_modules`)
 - To update translation keys, run a little script:
```js
#!/usr/bin/env node
require("traks/tool").change_signature_normalizer_version(require("./traks-config"), /*old version=*/0, /*new version=*/1);
```
 - Babel preset, sometimes found in `config-overrides.js`, must be changed from
   `traks/react-app` to `traks/react-app1`.

This ought to be it, but sometimes conflicts occur. The `change_signature_normalizer_version` script
above refuses to update `traks-translations.js` at all if any conflict occurs, so in that sense it's safe.
There isn't always an easy way to fix these, but conflicts mention the conflicting keys, so you can try:
 - searching for these keys
 - deleting similar looking translations
 - deleting all `_deleted` translations with:
```js
#!/usr/bin/env node
require("traks/tool").prune_deleted_translations(require("./traks-config"));
```
When the script succeeds, your git diff should show a lot of changed translation keys.
